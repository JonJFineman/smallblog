# Copyright (c) 2013, Aaron Fineman <aaron@fineman.me>
#
# Permission to use, copy, modify, and/or distribute this software for
# any purpose with or without fee is hereby granted, provided that the
# above copyright notice and this permission notice appear in all
# copies.
#
# THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS
# ALL WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL
# IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO
# EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
# INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
# WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS,
# WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
# TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE
# USE OR PERFORMANCE OF THIS SOFTWARE.

# Configuration
blog_dir="blog"
title="blog"



# Output the header
echo "
<!DOCTYPE html>
<html>
	<head>
		<title>$title</title>
		<link rel="stylesheet" href="main.css">
	</head>
	<body>
		<div class="container">
			<div class="site">
				<div class"header">
					<h1 class="title"><a href="/blog">mnetic.ch/blog</a></h1>
				</div>
"

# Iterate over year/month/day/* to generate an output
for year in `ls "${blog_dir}/"`; do
	if [ -d "${blog_dir}/${year}" ]; then
		for month in `ls "${blog_dir}/${year}/"`; do
			for day in `ls "${blog_dir}/${year}/${month}/"`; do
				for post in `ls "${blog_dir}/${year}/${month}/${day}/"`; do
					if echo "${post}" | grep -q "\.md$"; then
						post_path="${blog_dir}/${year}/${month}/${day}/"

# Generate a post
# Take a markdown formatted text file, and append the divs to it
echo "<p><div class=\"post\">"
markdown "${post_path}/${post}"
echo "</div></p>"

					fi
				done
			done
		done
	fi
done



# Output the footer
echo "
			</div>
		</div>
	</body>
</html>
"
